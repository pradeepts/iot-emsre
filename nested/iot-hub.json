{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "iotHubSettings": {
            "type": "object"
        },
        "apiVersions": {
            "type": "object"
        },
        "omsSettings": {
            "type": "object"
        }
    },
    "variables": {},
    "resources": [
        {
            "apiVersion": "[parameters('apiVersions').iotHubApiversion]",
            "type": "Microsoft.Devices/IotHubs",
            "location": "[parameters('iotHubSettings').location]",
            "name": "[parameters('iotHubSettings').iotHubName]",
            "sku": {
                "name": "[parameters('iotHubSettings').skuName]",
                "capacity": "[parameters('iotHubSettings').capacityUnits]"
            },
            "properties": {
                "eventHubEndpoints": {
                    "events": {
                        "retentionTimeInDays": "[parameters('iotHubSettings').d2cMessageRetentionInDaysPeriod]",
                        "partitionCount":"[parameters('iotHubSettings').d2cPartitionCount]"
                    }
                }
            },
        
            "resources": [
            {         
                 "name": "Microsoft.Insights/service",
            "type": "providers/diagnosticSettings",
            "apiVersion": "2015-07-01",
            "dependsOn": [
              "[concat('Microsoft.Devices/IotHubs/', parameters('iotHubSettings').iotHubName)]"
            ],
            "properties": {
                "workspaceId": "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('omsSettings').omsWorkspaceName)]",
                "logs": [
                    {
                      "category": "Connections",
                      "enabled": true,
                      "retentionPolicy": {
                        "days": 0,
                        "enabled": false
                      }
                    }
                ],
                  "metrics": [
                    {
                      "timeGrain": "PT1M",
                      "enabled": true,
                        "retentionPolicy": {
                               "enabled": false,
                               "days": 0
                        }
                    }
                ]
      
            }
        }
        ]
    }
    ]
}